set nocompatible  "Must be first: use Vim defaults (much better!).

let mapleader = ","  "Plugins may use the mapleader, so set first.

"Should occaianly call `:PlugUpdate` from vim.
call plug#begin('~/.vim/plugged')
Plug 'morhetz/gruvbox'
Plug 'tpope/vim-speeddating'
Plug 'jpalardy/vim-slime'
Plug 'rstacruz/sparkup'
Plug 'ntpeters/vim-better-whitespace'
let g:strip_whitespace_on_save = 0
let g:current_line_whitespace_disabled_soft = 1
let g:current_line_whitespace_disabled_hard = 0
Plug 'mhinz/vim-signify'
Plug 'andymass/vim-matchup'
Plug 'bling/vim-airline'
let g:airline_powerline_fonts = 1
let g:airline_left_sep = '›'  "Slightly fancier than '>'.
let g:airline_right_sep = '‹'  "Slightly fancier than '<'.
set laststatus=2  "Always show
call plug#end()

"This is totally awesome - remap jj to escape in insert mode.
"You'll never type jj anyway, so it's great!
inoremap jj <Esc>

set mouse=  "Disable the mouse which I pretty much never want.

set ignorecase  "Makes search case insensitive when pattern is all lowercase.
set smartcase
set incsearch
set hlsearch
nnoremap <C-l> :nohlsearch<CR><C-l>
autocmd InsertEnter * :setlocal nohlsearch
autocmd InsertLeave * :setlocal hlsearch

set wrapscan  "Wrap searches around from the end of the file.
set gdefault  "Sub all instances on a line with :s/old/new/.

"When editing a file, always jump to the last cursor position
autocmd BufReadPost * if line("'\"") | exe "'\"" | endif

set bs=2  "Allow backspacing over everything in insert mode.
set nobackup
set viminfo='20,\"50  "Don't store more than 50 lines of registers.
set history=50  "Keep 50 lines of command line history.
set tabstop=4
set shiftwidth=4
set softtabstop=4
set expandtab  "So we get spaces instaed of tabs in files.
set shiftround  "Use muliple of shiftwith with <>.
set nofoldenable  "Start w/o folds, enable when a fold cmd is used.
set scrolloff=5  "Keep five lines showeng around cursor.
set textwidth=0  "Wrap lines in a buffer, but wrap on-screen at word boundries.
set wrapmargin=0
set lbr
set wrap
set showmatch  "Briefly jump to the matching paren when one is inserted.
set showmode
set encoding=utf-8
set showcmd
set wildmenu
set wildmode=list:longest
set visualbell
set cursorline
set backspace=indent,eol,start
set nrformats-=octal  " Don't treat 0 prefixed numbers as octal with ^A
set ttimeout
set ttimeoutlen=100
set display+=lastline
if &listchars ==# 'eol:$'
    set listchars=tab:>\ ,trail:-,extends:>,precedes:<,nbsp:+
endif
set formatoptions+=j  " Del comment char when joining lines.
set autoread
set fileformats+=mac
set modelines=0  " Do not use modelines, from other people.
set hidden  "Save the buffer, like when useing :e
set ai  "autoindent (cp prev line), some plugins enable in, so set it.
set number
filetype plugin indent on
" Don't use Ex mode, use Q for formatting
noremap Q gq

" Sometimes detected as Modula-2, which I'll never use.
autocmd BufNewFile,BufReadPost,BufFilePre,BufRead *.md set filetype=markdown
autocmd BufNewFile,BufReadPost,BufFilePre,BufRead *.md set textwidth=78
autocmd BufNewFile,BufReadPost,BufFilePre,BufRead *.md set wrapmargin=78

" Switch syntax highlighting on, when the terminal has colors
syntax enable
set termguicolors
set background=dark
set colorcolumn=80
let g:gruvbox_contrast_dark = 'hard'
colorscheme gruvbox

"Use ; as if it were :.
nnoremap ; :
vnoremap ; :
"Set \ to what ; used to be (re-do last f, F, t, or T).
nnoremap \ ;
vnoremap \ ;

if has('nvim')
    execute 'nnoremap <leader>aa :w!<CR>:terminal aspell --dont-backup --encoding=UTF-8 --mode=none check "%"<CR>:e! "%"<CR><CR>'
    execute 'nnoremap <leader>ae :w!<CR>:terminal aspell --dont-backup --encoding=UTF-8 --mode=email check "%"<CR>:e! "%"<CR><CR>'
    execute 'nnoremap <leader>ah :w!<CR>:terminal aspell --dont-backup --encoding=UTF-8 --mode=html check "%"<CR>:e! "%"<CR><CR>'
    execute 'nnoremap <leader>at :w!<CR>:terminal aspell --dont-backup --encoding=UTF-8 --mode=tex check "%"<CR>:e! "%"<CR><CR>'
    "Neovim's term starts in normal mode and keeps the buf open after end.
    autocmd TermOpen term://*aspell* call feedkeys('i')
    autocmd TermClose term://*aspell* call feedkeys('<cr>')
else
    execute 'nnoremap <leader>aa :w!<CR>:!aspell --dont-backup --encoding=UTF-8 --mode=none check "%"<CR>:e! "%"<CR><CR>'
    execute 'nnoremap <leader>ae :w!<CR>:!aspell --dont-backup --encoding=UTF-8 --mode=email check "%"<CR>:e! "%"<CR><CR>'
    execute 'nnoremap <leader>ah :w!<CR>:!aspell --dont-backup --encoding=UTF-8 --mode=html check "%"<CR>:e! "%"<CR><CR>'
    execute 'nnoremap <leader>at :w!<CR>:!aspell --dont-backup --encoding=UTF-8 --mode=tex check "%"<CR>:e! "%"<CR><CR>'
endif
"Insert date at end of line.
execute "nnoremap <leader>s :put =strftime('%Y-%m-%d')<CR>kJ$"
"This is the total thing
execute "nnoremap <leader>t yypkIvimrc_var_a=(<Esc>A);scale=2;vimrc_var_a/1<Esc>!!b<CR>:put =strftime('%Y-%m-%d')<CR>kJJ0f.llli<Space>"
"BC !
execute 'nnoremap <leader>b !!b<CR>'
"URL convert
execute 'nnoremap <leader>u !!tr-url-escapes<CR>'
"run addr
execute 'nnoremap <leader>d !!addr<CR>'
